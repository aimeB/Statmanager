<!-- âœ… VÃ©rification si le terrain est bien chargÃ© -->
<div class="terrain-container" *ngIf="terrain && terrainJoueurs">
  <h2 class="title">ğŸ† Terrain de Jeu</h2>

  âœ… SÃ©lecteur de Formation
  <div class="formation-selection">
    <mat-form-field appearance="outline">
      <mat-label>Formation</mat-label>
      <mat-select [(value)]="formationActive" (selectionChange)="changerFormation($event)">
        <mat-option *ngFor="let formation of getFormationsDisponibles()" [value]="formation">
          {{ formation }}
        </mat-option>
      </mat-select>
    </mat-form-field>
  </div>

  <!-- âœ… Terrain avec structure FOOT rÃ©aliste -->
  <div class="terrain-grid">
    <!-- ğŸ¯ GARDIEN (Toujours seul en haut) -->
    <div class="ligne gardien">
      <mat-card class="poste gardien" (click)="ouvrirSelectionJoueur('GB')">
        <h4>GB</h4>
        <p>{{ terrainJoueurs['GB']?.nom || 'âŒ Aucun joueur' }}</p>
        <button
          mat-button
          color="warn"
          *ngIf="terrainJoueurs['GB']"
          (click)="reinitialiserPoste('GB'); $event.stopPropagation()"
        >
          RÃ©initialiser
        </button>
      </mat-card>
    </div>

    <!-- ğŸ¯ DÃ‰FENSE -->
    <div class="ligne defense">
      <mat-card
        *ngFor="let posteKey of getPostesFormation().defense"
        class="poste defenseur"
        (click)="ouvrirSelectionJoueur(posteKey)"
      >
        <h4>{{ posteKey }}</h4>
        <p>{{ terrainJoueurs[posteKey]?.nom || 'âŒ Aucun joueur' }}</p>
        <button
          mat-button
          color="warn"
          *ngIf="terrainJoueurs[posteKey]"
          (click)="reinitialiserPoste(posteKey); $event.stopPropagation()"
        >
          RÃ©initialiser
        </button>
      </mat-card>
    </div>

    <!-- ğŸ¯ MILIEU DE TERRAIN -->
    <div class="ligne milieux">
      <mat-card
        *ngFor="let posteKey of getPostesFormation().milieu"
        class="poste milieux"
        (click)="ouvrirSelectionJoueur(posteKey)"
      >
        <h4>{{ posteKey }}</h4>
        <p>{{ terrainJoueurs[posteKey]?.nom || 'âŒ Aucun joueur' }}</p>
        <button
          mat-button
          color="warn"
          *ngIf="terrainJoueurs[posteKey]"
          (click)="reinitialiserPoste(posteKey); $event.stopPropagation()"
        >
          RÃ©initialiser
        </button>
      </mat-card>
    </div>

    <!-- ğŸ¯ ATTAQUE -->
    <div class="ligne attaquants">
      <mat-card
        *ngFor="let posteKey of getPostesFormation().attaque"
        class="poste attaquant"
        (click)="ouvrirSelectionJoueur(posteKey)"
      >
        <h4>{{ posteKey }}</h4>
        <p>{{ terrainJoueurs[posteKey]?.nom || 'âŒ Aucun joueur' }}</p>
        <button
          mat-button
          color="warn"
          *ngIf="terrainJoueurs[posteKey]"
          (click)="reinitialiserPoste(posteKey); $event.stopPropagation()"
        >
          RÃ©initialiser
        </button>
      </mat-card>
    </div>
  </div>

  <!-- ğŸ“‹ Liste des Joueurs Disponibles -->
  <div class="joueurs-disponibles">
    <h3>ğŸ“‹ Joueurs Disponibles</h3>
    <div class="joueurs-list">
      <mat-chip
        *ngFor="let joueur of joueursDisponibles; trackBy: trackByJoueur"
        class="joueur-chip"
      >
        {{ joueur.nom }} ({{ joueur.poste }})
      </mat-chip>
    </div>
  </div>
  <!-- âœ… Validation de la formation -->
  <div class="actions">
    <button
      mat-fab
      color="primary"
      class="validate-button"
      (click)="validerTerrain()"
      [disabled]="!estTerrainComplet()"
    >
      âœ… Lancer la Partie
    </button>
  </div>

  <!-- âŒ Terrain non chargÃ© -->
  <div *ngIf="!terrain || !terrainJoueurs" class="terrain-empty">
    <h2>âŒ Aucun terrain chargÃ©</h2>
    <p>Veuillez d'abord crÃ©er une rencontre pour gÃ©nÃ©rer un terrain.</p>
  </div>
</div>
